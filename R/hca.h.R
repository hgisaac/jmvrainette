
# This file is automatically generated, you probably don't want to edit this

hcaOptions <- if (requireNamespace('jmvcore', quietly=TRUE)) R6::R6Class(
    "hcaOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            text = NULL,
            doublecluster = FALSE,
            segsize = 40,
            tolower = TRUE,
            rmvpunct = TRUE,
            lang = "english",
            mintermfreq = 3,
            kmeans = 6,
            minucsize = 10,
            minucsize2 = 15,
            minsplit = 20,
            kgroup = 5,
            completegroups = FALSE,
            plottype = "bar",
            nterms = 20,
            freescales = FALSE,
            measure = "chi2",
            partcriterion = "chi2",
            negative = TRUE,
            textsize = 12,
            showstats = FALSE, ...) {

            super$initialize(
                package='jmvrainette',
                name='hca',
                requiresData=TRUE,
                ...)

            private$..text <- jmvcore::OptionVariable$new(
                "text",
                text)
            private$..doublecluster <- jmvcore::OptionBool$new(
                "doublecluster",
                doublecluster,
                default=FALSE)
            private$..segsize <- jmvcore::OptionInteger$new(
                "segsize",
                segsize,
                default=40)
            private$..tolower <- jmvcore::OptionBool$new(
                "tolower",
                tolower,
                default=TRUE)
            private$..rmvpunct <- jmvcore::OptionBool$new(
                "rmvpunct",
                rmvpunct,
                default=TRUE)
            private$..lang <- jmvcore::OptionList$new(
                "lang",
                lang,
                options=list(
                    "english",
                    "portugues"),
                default="english")
            private$..mintermfreq <- jmvcore::OptionInteger$new(
                "mintermfreq",
                mintermfreq,
                default=3)
            private$..kmeans <- jmvcore::OptionInteger$new(
                "kmeans",
                kmeans,
                default=6)
            private$..minucsize <- jmvcore::OptionInteger$new(
                "minucsize",
                minucsize,
                default=10)
            private$..minucsize2 <- jmvcore::OptionInteger$new(
                "minucsize2",
                minucsize2,
                default=15)
            private$..minsplit <- jmvcore::OptionInteger$new(
                "minsplit",
                minsplit,
                default=20)
            private$..kgroup <- jmvcore::OptionInteger$new(
                "kgroup",
                kgroup,
                default=5)
            private$..completegroups <- jmvcore::OptionBool$new(
                "completegroups",
                completegroups,
                default=FALSE)
            private$..plottype <- jmvcore::OptionList$new(
                "plottype",
                plottype,
                options=list(
                    "bar",
                    "cloud"),
                default="bar")
            private$..nterms <- jmvcore::OptionInteger$new(
                "nterms",
                nterms,
                default=20)
            private$..freescales <- jmvcore::OptionBool$new(
                "freescales",
                freescales,
                default=FALSE)
            private$..measure <- jmvcore::OptionList$new(
                "measure",
                measure,
                options=list(
                    "chi2",
                    "lr"),
                default="chi2")
            private$..partcriterion <- jmvcore::OptionList$new(
                "partcriterion",
                partcriterion,
                options=list(
                    "chi2",
                    "n"),
                default="chi2")
            private$..negative <- jmvcore::OptionBool$new(
                "negative",
                negative,
                default=TRUE)
            private$..textsize <- jmvcore::OptionInteger$new(
                "textsize",
                textsize,
                default=12)
            private$..showstats <- jmvcore::OptionBool$new(
                "showstats",
                showstats,
                default=FALSE)

            self$.addOption(private$..text)
            self$.addOption(private$..doublecluster)
            self$.addOption(private$..segsize)
            self$.addOption(private$..tolower)
            self$.addOption(private$..rmvpunct)
            self$.addOption(private$..lang)
            self$.addOption(private$..mintermfreq)
            self$.addOption(private$..kmeans)
            self$.addOption(private$..minucsize)
            self$.addOption(private$..minucsize2)
            self$.addOption(private$..minsplit)
            self$.addOption(private$..kgroup)
            self$.addOption(private$..completegroups)
            self$.addOption(private$..plottype)
            self$.addOption(private$..nterms)
            self$.addOption(private$..freescales)
            self$.addOption(private$..measure)
            self$.addOption(private$..partcriterion)
            self$.addOption(private$..negative)
            self$.addOption(private$..textsize)
            self$.addOption(private$..showstats)
        }),
    active = list(
        text = function() private$..text$value,
        doublecluster = function() private$..doublecluster$value,
        segsize = function() private$..segsize$value,
        tolower = function() private$..tolower$value,
        rmvpunct = function() private$..rmvpunct$value,
        lang = function() private$..lang$value,
        mintermfreq = function() private$..mintermfreq$value,
        kmeans = function() private$..kmeans$value,
        minucsize = function() private$..minucsize$value,
        minucsize2 = function() private$..minucsize2$value,
        minsplit = function() private$..minsplit$value,
        kgroup = function() private$..kgroup$value,
        completegroups = function() private$..completegroups$value,
        plottype = function() private$..plottype$value,
        nterms = function() private$..nterms$value,
        freescales = function() private$..freescales$value,
        measure = function() private$..measure$value,
        partcriterion = function() private$..partcriterion$value,
        negative = function() private$..negative$value,
        textsize = function() private$..textsize$value,
        showstats = function() private$..showstats$value),
    private = list(
        ..text = NA,
        ..doublecluster = NA,
        ..segsize = NA,
        ..tolower = NA,
        ..rmvpunct = NA,
        ..lang = NA,
        ..mintermfreq = NA,
        ..kmeans = NA,
        ..minucsize = NA,
        ..minucsize2 = NA,
        ..minsplit = NA,
        ..kgroup = NA,
        ..completegroups = NA,
        ..plottype = NA,
        ..nterms = NA,
        ..freescales = NA,
        ..measure = NA,
        ..partcriterion = NA,
        ..negative = NA,
        ..textsize = NA,
        ..showstats = NA)
)

hcaResults <- if (requireNamespace('jmvcore', quietly=TRUE)) R6::R6Class(
    inherit = jmvcore::Group,
    active = list(
        plot = function() private$.items[["plot"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Hierarchical Clustering Analysis")
            self$add(jmvcore::Image$new(
                options=options,
                name="plot",
                title="Plot",
                width=600,
                height=650,
                renderFun=".plot"))}))

hcaBase <- if (requireNamespace('jmvcore', quietly=TRUE)) R6::R6Class(
    "hcaBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = 'jmvrainette',
                name = 'hca',
                version = c(0,3,0),
                options = options,
                results = hcaResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE)
        }))

#' Hierarchical Clustering Analysis
#'
#' 
#' @param data .
#' @param text .
#' @param doublecluster .
#' @param segsize .
#' @param tolower .
#' @param rmvpunct .
#' @param lang .
#' @param mintermfreq .
#' @param kmeans .
#' @param minucsize .
#' @param minucsize2 .
#' @param minsplit .
#' @param kgroup .
#' @param completegroups .
#' @param plottype .
#' @param nterms .
#' @param freescales .
#' @param measure .
#' @param partcriterion .
#' @param negative .
#' @param textsize .
#' @param showstats .
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$plot} \tab \tab \tab \tab \tab an image \cr
#' }
#'
#' @export
hca <- function(
    data,
    text,
    doublecluster = FALSE,
    segsize = 40,
    tolower = TRUE,
    rmvpunct = TRUE,
    lang = "english",
    mintermfreq = 3,
    kmeans = 6,
    minucsize = 10,
    minucsize2 = 15,
    minsplit = 20,
    kgroup = 5,
    completegroups = FALSE,
    plottype = "bar",
    nterms = 20,
    freescales = FALSE,
    measure = "chi2",
    partcriterion = "chi2",
    negative = TRUE,
    textsize = 12,
    showstats = FALSE) {

    if ( ! requireNamespace('jmvcore', quietly=TRUE))
        stop('hca requires jmvcore to be installed (restart may be required)')

    if ( ! missing(text)) text <- jmvcore::resolveQuo(jmvcore::enquo(text))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(text), text, NULL))


    options <- hcaOptions$new(
        text = text,
        doublecluster = doublecluster,
        segsize = segsize,
        tolower = tolower,
        rmvpunct = rmvpunct,
        lang = lang,
        mintermfreq = mintermfreq,
        kmeans = kmeans,
        minucsize = minucsize,
        minucsize2 = minucsize2,
        minsplit = minsplit,
        kgroup = kgroup,
        completegroups = completegroups,
        plottype = plottype,
        nterms = nterms,
        freescales = freescales,
        measure = measure,
        partcriterion = partcriterion,
        negative = negative,
        textsize = textsize,
        showstats = showstats)

    analysis <- hcaClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

